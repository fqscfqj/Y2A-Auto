services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      # args:
      #   ENABLE_GPU_DRIVERS: "true"  # 启用 Intel/AMD GPU VA-API 驱动
    image: y2a-auto:local
    container_name: y2a-auto
    restart: unless-stopped
    ports:
      - "5000:5000"
    
    # 挂载目录
    volumes:
      - ./config:/app/config
      - ./db:/app/db
      - ./downloads:/app/downloads
      - ./logs:/app/logs
      - ./cookies:/app/cookies
      - ./temp:/app/temp

    # 环境变量配置
    environment:
      - TZ=Asia/Shanghai
      - PYTHONIOENCODING=utf-8
      - VIDEO_ENCODER=auto

    # ========================================
    # GPU 硬件编码加速配置（可选）
    # 根据您的显卡类型，取消注释对应的配置部分
    # ========================================

    # --- NVIDIA GPU 配置 ---
    # 需要安装 nvidia-container-toolkit
    # 安装指南: https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html
    # 普通 `docker compose` 推荐使用 gpus + NVIDIA_* 环境变量；
    # `deploy.resources...` 仅在 Swarm (`docker stack deploy`) 下生效。
    # gpus: all
    # environment:
    #   - NVIDIA_VISIBLE_DEVICES=all
    #   - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # runtime: nvidia
    #
    # Swarm 示例：
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu, video]

    # --- Intel GPU 配置 (QSV) ---
    # 需要挂载 /dev/dri 设备
    # devices:
    #   - /dev/dri:/dev/dri
    # group_add:
    #   - video
    #   - render

    # --- AMD GPU 配置 (VAAPI) ---
    # 需要挂载 /dev/dri 设备
    # devices:
    #   - /dev/dri:/dev/dri
    # group_add:
    #   - video
    #   - render